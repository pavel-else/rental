# Rentix doc
    Описана работа приложения app.rentix.biz

## Общая информация
    В качестве менеджера задач используется Trello https://trello.com/b/CrHRDsnG/web-rentix

### GIT
    В рабочем проекте несколько веток - maser, dev
    В dev находится версия для разработки. Все текущие коммиты отражены в ней.
    В master находится версия для продакшена.

    В сообщении коммита ветки dev указывается название измененного компонента (или логическая часть программы) и ниже конкретный мод
    Например:
        History
        - changed times view to hh:mm format

    В сообщении коммита ветки master указывается версия программы и ниже главные изменения.
    Например:
        v. 1.2.0
        - Добавлен модуль ремонта
        - Переработ механизм обмена информацией с сервером

    В master не должны попадать мелкие коммиты из dev`a, они должны объединяться при помощи git merge dev --squash или git reset --soft

### Другое
    В проекте для отступов используются 4 пробела
    В файлах .js строки заканчиваются символом ';'



## Компонент
### Общая структура
    <template></template>
    <script>
        import copy from '@/functions/copy';
        export default {
            name: 'History',

            // Входящие параметры
            // Если компонент меняет входящий объект, то нужно создавать копию этого объекта. Используется пользоват. функция copy()
            props: {
                _product: Object //
                productName: String
            },

            components: {
                Details
            },

            // Хуки
            created() {},

            // Рабочие данные
            data() {
                return {
                    product: copy(this.product),
                    foo: 'baz',
                }
            },

            
            methods() {},
            computed() {},
            watch() {}
        }
    </script>
    <style scoped></style>

## Стор
структура стора:
    export default {

        // state (Стэйт)
        // Содержит сущности, существительные
        state: {
            name: null,
            address: null,
            phone: null
        },

        // getters (Геттеры)
        // Из приложения к геттерам обращаются так: this.$store.getters.rentalPointInfo, т.е. как бы через приставку getters
        // Поэтому они именуются как существительные (rentalPointInfo)
        getters: {
            rentalPointInfo(state) {
                return {
                    name: state.name,
                    address: state.address,
                    phone: state.phone
                }
            }
        },

        // mutations (Мутэйшины)
        // Должны быть синхронными
        // Изменяют стэйт, причем стэйт меняют только они
        // Из приложения их вызвать можно, но не нужно. Они Вызываются только из Экшнов,
        // через ключевое слово commit. Например: commit('rentalPointInfo')
        // Именовать без приставки set, просто именем существительным, как бы указывая что именно нужно изменить
        mutations: {
            rentalPointInfo(state, rentalPointInfo) {
                for (let i in rentalPointInfo) {
                    state[i] = rentalPointInfo[i];
                }
            }
        },

        // actions (Экшины)
        // Работают асинхронно, запросы к API делают именно они
        // Если нужно, вызывают мутации стэйта
        // Имена придумывать относительно приложения, можно использовать приставки get, set и.т.д
        actions: {
            getOrders({ commit, getters }) { 
                // Здесь асинхронный запрос к API на выборку ордеров из БД
                // Затех сохранение этих данных в стэйт посредством commit
            }
        }
    }

## Основные сущности

### Ордеры и сабордеры

Основными сущностями программы являются ордеры (orders) и сабордеры (subOrders).
Сабордерами - это товары в ордере. (Они не называются "Товарами" или "Продуктами" т.к. в контексте приложения под этими названиями понимаются другие сущности - товары вообще)

К одному ордеру может принадлежать несколько сабордеров.
Связь между ними такая: order.id_rent === subOrder.order_id.
Т.е. у каждого сабордера есть отметка - к какому ордеру он принадлежит

Ордер содержит в себе общую информацию о заказе: начало заказа, аванс, ВРЕМЯ СТАРТА, id клиента и тд.
Сабордер содержит в себе только частную информацию: время стопа, суммарное время паузы, стоимость проката, скидки и тд.

У каждого ордера и сабордера есть поле статус, при этом
order.status = 'ACTIVE' || 'END' || 'DEL'
subOrder.status = 'ACTIVE' || 'END' || 'DEL' || 'PAUSE'


### Продукты
...

### Клиенты
...


## Работа приложения

Точкой входа в приложение является main.js
Он прогружает главные зависимости и монтируется приложение в контейнер #app

Базовая структура приложения реализована в App.vue
В приложении используется 2 режима, которые переключаются из программы:
- Обычный
- Режим печати документа

В обычном режиме перед началом работы если пользователь не авторизован, его перенаправляет на страницу авторизации. Если он авторизован, делается запрос на API для выборки ордеров, клиентов, товаров, настроек и т.д.

Далее запускается таймер, который обновляет часы в каждом активном ордере

Основная работа приложения ведется на роуте Main

### Main (page)

Перед началом работы компонента осуществляется загрузка данных.

    getActiveOrders
    getActiveSubOrders 
    getProducts
    getTariffs
    getCustomers 
    getAccessories
    getGeneralSettings

Нужно учитывать, что этот компонент работает только с активными ордерами и сабордерами,
т. е. с сервера запрашиваются все те ордера и сабордера, статус которых равен 'ACTIVE' или 'PAUSE'